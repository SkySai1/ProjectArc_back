# Документация по тестам

## Общая информация

Тесты в проекте предназначены для проверки функциональности маршрутов, работы с СУБД и корректной интеграции. 
Все тесты используют `pytest` и базируются на фикстурах, определённых в `tests/conftest.py`.

## Фикстуры

Фикстуры определены в файле `tests/conftest.py` и включают:

1. **`temp_test_dir`**
   - Создаёт временную директорию для тестовых данных.
   - Используется для хранения временных файлов, таких как база данных SQLite и тестовые данные.

2. **`app`**
   - Создаёт тестовый экземпляр Flask-приложения с использованием временной конфигурации.
   - Инициализирует базу данных перед тестами.

3. **`client`**
   - Предоставляет тестовый клиент Flask для выполнения запросов к API.

## Тесты для `about`

Тесты расположены в `tests/test_about.py` и включают следующие проверки:

### 1. **`test_get_about_empty`**
- **Описание:** Проверяет поведение при попытке получить описание проекта, если оно отсутствует.
- **Запрос:** `GET /about`
- **Ожидаемый результат:**
  - Код ответа: `404`
  - Сообщение: `{ "error": "Project description does not exist." }`

### 2. **`test_create_and_get_about`**
- **Описание:** Проверяет создание описания проекта и последующее получение данных.
- **Шаги:**
  1. Отправляется запрос `POST /about` с описанием проекта.
  2. Проверяется, что файл `project_description.json` создан во временной директории.
  3. Выполняется запрос `GET /about` для проверки сохранённого описания.
- **Ожидаемый результат:**
  - Код ответа: `201` при создании.
  - Код ответа: `200` при получении.

### 3. **`test_update_about`**
- **Описание:** Проверяет обновление описания проекта.
- **Шаги:**
  1. Отправляется запрос `PUT /about` с новым описанием.
  2. Проверяется обновлённый файл во временной директории.
  3. Выполняется запрос `GET /about` для проверки обновлений.
- **Ожидаемый результат:**
  - Код ответа: `200` при обновлении.
  - Обновлённое описание в ответе.

### 4. **`test_create_about_already_exists`**
- **Описание:** Проверяет поведение при попытке повторного создания описания проекта.
- **Запрос:** `POST /about`
- **Ожидаемый результат:**
  - Код ответа: `400`
  - Сообщение: `{ "error": "Project description already exists." }`

### Диаграмма выполнения тестов для `test_about.py`

```mermaid
graph TD
    A[client] -->|GET /about| B[Проверка отсутствия описания]
    B -->|POST /about| C[Создание описания проекта]
    C -->|GET /about| D[Проверка содержимого]
    D -->|PUT /about| E[Обновление описания]
    E -->|GET /about| F[Проверка обновлённого содержимого]
    C -->|POST /about| G[Повторное создание описания]
    G -->|Ожидание ошибки| H[Код ответа 400]
```

## Тесты для `files`

Тесты расположены в `tests/test_files.py` и включают следующие проверки:

### 1. **`test_create_file_missing_filename`**
- **Описание:** Проверяет поведение при создании файла без указания имени.
- **Запрос:** `POST /files/create`
- **Ожидаемый результат:**
  - Код ответа: `400`
  - Сообщение: `{ "error": "Filename is required." }`

### 2. **`test_create_file_success`**
- **Описание:** Проверяет успешное создание файла.
- **Запрос:** `POST /files/create`
- **Ожидаемый результат:**
  - Код ответа: `201`
  - Сообщение: `"File 'test.txt' created successfully."`

### 3. **`test_delete_file`**
- **Описание:** Проверяет удаление существующего файла.
- **Шаги:**
  1. Создаётся файл через запрос `POST /files/create`.
  2. Выполняется запрос `DELETE /files/delete` для удаления файла.
- **Ожидаемый результат:**
  - Код ответа: `200`
  - Сообщение: `"File 'test.txt' deleted from project database."`

### 4. **`test_delete_file_nonexistent`**
- **Описание:** Проверяет удаление несуществующего файла.
- **Запрос:** `DELETE /files/delete`
- **Ожидаемый результат:**
  - Код ответа: `404`
  - Сообщение: `"File 'nonexistent.txt' does not exist."`

### 5. **`test_update_file`**
- **Описание:** Проверяет успешное обновление описания файла.
- **Шаги:**
  1. Создаётся файл через запрос `POST /files/create`.
  2. Выполняется запрос `PUT /files/update` для обновления описания файла.
- **Ожидаемый результат:**
  - Код ответа: `200`
  - Сообщение: `"File 'test.txt' information updated successfully."`

### 6. **`test_update_file_nonexistent`**
- **Описание:** Проверяет обновление описания для несуществующего файла.
- **Запрос:** `PUT /files/update`
- **Ожидаемый результат:**
  - Код ответа: `404`
  - Сообщение: `"File 'nonexistent.txt' does not exist."`

### Диаграмма выполнения тестов для `test_files.py`

```mermaid
graph TD
    A[client] -->|POST /files/create| B[Создание файла]
    A -->|DELETE /files/delete| C[Удаление файла]
    A -->|PUT /files/update| D[Обновление описания]

    B -->|Успешное создание| E[Проверка содержимого в БД]
    C -->|Успешное удаление| F[Проверка отсутствия записи в БД]
    D -->|Успешное обновление| G[Проверка обновлений в БД]
    C -->|Удаление несуществующего файла| H[Ошибка: код 404]
    D -->|Обновление несуществующего файла| I[Ошибка: код 404]
```

## Запуск тестов

Для запуска тестов выполните команду:
```bash
pytest
```

Для детального вывода:
```bash
pytest -v
```